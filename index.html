<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>Northwind SQL ArayÃ¼zÃ¼</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background-color: #f9f9f9; }
    .section-card { margin-bottom: 2rem; }
    table th, table td { vertical-align: middle; }
  </style>
</head>
<body>
  <div class="container py-4">
    <h1 class="text-center text-primary mb-4">ðŸ“Š Northwind SQL ArayÃ¼zÃ¼</h1>

    <!-- 1. MÃ¼ÅŸteri SipariÅŸleri -->
    <div class="card section-card">
      <div class="card-header bg-primary text-white">MÃ¼ÅŸteri SipariÅŸleri</div>
      <div class="card-body">
        <input type="text" id="customerName" class="form-control mb-2" placeholder="MÃ¼ÅŸteri adÄ± girin">
        <button class="btn btn-primary" onclick="getOrders()">SipariÅŸleri Getir</button>
        <div class="table-responsive mt-3 d-none" id="ordersTableWrapper">
          <table class="table table-striped">
            <thead><tr><th>SipariÅŸ ID</th><th>Tarih</th><th>ÃœrÃ¼n</th><th>Adet</th></tr></thead>
            <tbody id="ordersTableBody"></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- 2. Top 5 MÃ¼ÅŸteri -->
    <div class="card section-card">
      <div class="card-header bg-success text-white">Top 5 MÃ¼ÅŸteri</div>
      <div class="card-body">
        <button class="btn btn-success" onclick="getTopCustomers()">Listele</button>
        <div class="table-responsive mt-3 d-none" id="topCustomersWrapper">
          <table class="table table-bordered">
            <thead><tr><th>MÃ¼ÅŸteri</th><th>SipariÅŸ SayÄ±sÄ±</th></tr></thead>
            <tbody id="topCustomersTableBody"></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- 3. Ã‡alÄ±ÅŸan SatÄ±ÅŸ Ã–zeti -->
    <div class="card section-card">
      <div class="card-header bg-secondary text-white">Ã‡alÄ±ÅŸan SatÄ±ÅŸ Ã–zeti</div>
      <div class="card-body">
        <input type="text" id="employeeName" class="form-control mb-2" placeholder="Ã‡alÄ±ÅŸan adÄ± girin">
        <button class="btn btn-secondary" onclick="getEmployeeSales()">Getir</button>
        <div class="table-responsive mt-3 d-none" id="employeeSalesWrapper">
          <table class="table table-sm table-striped">
            <thead><tr><th>Ã‡alÄ±ÅŸan</th><th>SipariÅŸ SayÄ±sÄ±</th><th>Ãœlke SayÄ±sÄ±</th></tr></thead>
            <tbody id="employeeSalesTableBody"></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- 4. Stokta Kalmayan ÃœrÃ¼nler -->
    <div class="card section-card">
      <div class="card-header bg-warning text-dark">Stokta Kalmayan ÃœrÃ¼nler</div>
      <div class="card-body">
        <button class="btn btn-warning" onclick="getOutOfStock()">Listele</button>
        <div class="table-responsive mt-3 d-none" id="outOfStockWrapper">
          <table class="table table-bordered table-sm">
            <thead><tr><th>ÃœrÃ¼n</th><th>Toplam SipariÅŸ</th></tr></thead>
            <tbody id="outOfStockTableBody"></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- 5. YÄ±la GÃ¶re SatÄ±ÅŸ -->
    <div class="card section-card">
      <div class="card-header bg-dark text-white">YÄ±la GÃ¶re Toplam SatÄ±ÅŸ</div>
      <div class="card-body">
        <input type="number" id="salesYear" class="form-control mb-2" placeholder="YÄ±l girin (Ã¶rn: 1997)">
        <button class="btn btn-dark" onclick="getSalesByYear()">Sorgula</button>
        <div class="alert alert-info mt-3 d-none" id="salesYearResult"></div>
      </div>
    </div>
  </div>

  <script>
    function clearTable(wrapperId, bodyId) {
      document.getElementById(wrapperId).classList.add("d-none");
      document.getElementById(bodyId).innerHTML = "";
    }

    async function getOrders() {
      clearTable("ordersTableWrapper", "ordersTableBody");
      const name = document.getElementById("customerName").value;
      const res = await fetch(`http://localhost:3000/orders-by-customer?name=${name}`);
      const data = await res.json();
      const wrapper = document.getElementById("ordersTableWrapper");
      const tbody = document.getElementById("ordersTableBody");

      data.forEach(row => {
        tbody.innerHTML += `<tr><td>${row.OrderID}</td><td>${new Date(row.OrderDate).toLocaleDateString()}</td><td>${row.ProductName}</td><td>${row.Quantity}</td></tr>`;
      });
      if (data.length > 0) wrapper.classList.remove("d-none");
    }

    async function getTopCustomers() {
      clearTable("topCustomersWrapper", "topCustomersTableBody");
      const res = await fetch(`http://localhost:3000/top-customers`);
      const data = await res.json();
      const wrapper = document.getElementById("topCustomersWrapper");
      const tbody = document.getElementById("topCustomersTableBody");

      data.forEach(row => {
        tbody.innerHTML += `<tr><td>${row.CompanyName}</td><td>${row.SiparisSayisi}</td></tr>`;
      });
      if (data.length > 0) wrapper.classList.remove("d-none");
    }

    async function getEmployeeSales() {
      clearTable("employeeSalesWrapper", "employeeSalesTableBody");
      const name = document.getElementById("employeeName").value;
      const res = await fetch(`http://localhost:3000/employee-sales-summary?name=${name}`);
      const data = await res.json();
      const wrapper = document.getElementById("employeeSalesWrapper");
      const tbody = document.getElementById("employeeSalesTableBody");

      data.forEach(row => {
        tbody.innerHTML += `<tr><td>${row.Employee}</td><td>${row.Orders}</td><td>${row.Countries}</td></tr>`;
      });
      if (data.length > 0) wrapper.classList.remove("d-none");
    }

    async function getOutOfStock() {
      clearTable("outOfStockWrapper", "outOfStockTableBody");
      const res = await fetch(`http://localhost:3000/out-of-stock-products`);
      const data = await res.json();
      const wrapper = document.getElementById("outOfStockWrapper");
      const tbody = document.getElementById("outOfStockTableBody");

      data.forEach(row => {
        tbody.innerHTML += `<tr><td>${row.ProductName}</td><td>${row.TotalOrdered}</td></tr>`;
      });
      if (data.length > 0) wrapper.classList.remove("d-none");
    }

    async function getSalesByYear() {
      const resultDiv = document.getElementById("salesYearResult");
      resultDiv.classList.add("d-none");
      const year = document.getElementById("salesYear").value;
      const res = await fetch(`http://localhost:3000/sales-by-year?year=${year}`);
      const data = await res.json();
      const amount = data.TotalSales ?? 0;
      resultDiv.innerText = `Toplam satÄ±ÅŸ (${year}): $${parseFloat(amount).toFixed(2)}`;
      resultDiv.classList.remove("d-none");
    }
  </script>
</body>
</html>
